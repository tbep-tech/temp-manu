---
title: "Exploratory data analysis"
author: 
   - name: Marcus Beck, <mbeck@tbep.org>
institute: "Tampa Bay Estuary Program"
date: "`r Sys.Date()`"
format:
  html:
    theme: cosmo
    css: styles.css
    code-tools: 
      source: https://github.com/tbep-tech/temp-manu/blob/main/index.qmd
execute:
  echo: false
  warning: false
filters:
  - lightbox
  
lightbox: auto
---

```{r}
library(tidyverse)
library(lubridate)
library(here)
```

# Complete record

This plot shows the significant increasing or decreasing temperature trends for all long-term monitoring stations (EPCHC) in Tampa Bay, by period of record and sampling location in the water column. The periods of record are 1974-2022 (whole record), 2007-2022 ([NOAA record](https://coastwatch.noaa.gov/cw_html/cwViewer.html)), 2000-2015 (seagrass recovery), and 2016-2022 (seagrass decline). The latter two periods of record likely have low statistical power with limited sample size. Seasonal Mann-Kendall tests are used.

```{r}
knitr::include_graphics(here('figs/sktall.png'))
```

# By month

These plots show significant increasing or decreasing temperature trends by month for long-term monitoring stations in Tampa Bay.  The plots are organized by period of record and sampling location in the water column. Mann-Kendal tests are used.

::: panel-tabset
```{r}
#| results: asis
fls <- list.files(here('figs'), 'skt_', full.names = F)
mos <- fls %>% 
  basename %>% 
  gsub('^skt_|\\.png', '', .) %>% 
  as.numeric() %>% 
  sort() %>% 
  month(label = T) %>% 
  as.character()
for(mo in seq_along(mos)){
  cat('## ', mos[mo], '\n\n')
  
  chnk <- paste0('![](figs/', fls[mo], ')\n')
  cat(chnk)
  
  cat('\n\n')
  
}
```
:::

# Month summary by bay segment

These plots show the percent of stations by month and bay segment that had significant increasing temperature trends for the specified period of record. Tabs are organized by top, mid, and bottom water column temperature measurements.  The summaries are based on results for the monthly trend tests in the previous section. Decreasing trends are not shown.

::: panel-tabset
```{r}
#| results: asis
fls <- list.files(here('figs'), 'segsum_', full.names = F) %>% 
  rev
locs <- fls %>% 
  basename %>% 
  gsub('^segsum_|\\.png', '', .)
for(loc in seq_along(locs)){
  cat('## ', locs[loc], '\n\n')
  
  chnk <- paste0('![](figs/', fls[loc], ')\n')
  cat(chnk)
  
  cat('\n\n')
  
}
```
:::

# Threshold exceedances

Temperature exceedences over time were estimated for major bay segments by using daily predictions from a Generalized Additive Model applied to each station. An example of a model is shown in the first plot. The date of the first and last instance each year for each of three temperature thresholds (20, 25, and 30 degrees C) were estimated.  The total number of days in each year when the daily temperature was above the same thresholds were also estimated.  The station level results were aggregated within each bay segment to produce the plots below.

```{r}
knitr::include_graphics(here('figs/gamex.png'))
knitr::include_graphics(here('figs/threxceed.png'))
knitr::include_graphics(here('figs/thrcount.png'))
```

